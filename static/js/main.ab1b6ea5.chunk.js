(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{36:function(e,t,n){e.exports=n(97)},41:function(e,t,n){},42:function(e,t,n){},89:function(e,t,n){},90:function(e,t,n){},92:function(e,t,n){},93:function(e,t,n){},94:function(e,t,n){},95:function(e,t,n){},97:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(28),s=n.n(r),i=(n(41),n(11)),c=n(12),l=n(14),u=n(13),d=n(15),m=n(10),p=(n(25),n(9),n(42),n(3)),h=n(16),v=(n(89),n(18)),f=(n(90),function(e){var t=e.links,n=e.closeNav,a=void 0===n?function(){return document.querySelector(".sidenav-overlay").click()}:n;return o.a.createElement(o.a.Fragment,null,t.map(function(e,t){return o.a.createElement("li",{key:t,onClick:a},o.a.createElement(v.a,{to:e.href},e.name))}))}),g=function(e){var t=e.links,n=e.className,a=void 0===n?"":n,r=Object(h.a)(e,["links","className"]);return o.a.createElement(p.Navbar,Object.assign({className:"red darken-3 ".concat(a),alignLinks:"right",brand:o.a.createElement(v.a,{to:"/"},"Where's My Bloody Bus!?"),sidenav:o.a.createElement(f,{links:t})},r),t.map(function(e,t){return o.a.createElement(v.a,{key:t,to:e.href},e.name)}))},b=n(100),E=n(101),w=n(17),S=n.n(w),k=n(21),C=n(22),N=(n(92),function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date,n=(new Date(e)-t)/1e3/60;return Math.round(n)}),y=function(e){window.localStorage.setItem("userData",JSON.stringify(e))},O=function(){var e=window.localStorage;return e.getItem("userData")||y({}),JSON.parse(e.userData)},j=new RegExp("^[0-9]{5}$"),x=function(){var e=Object(k.a)(S.a.mark(function e(t){var n,a;return S.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.getJSON("https://api.tfl.gov.uk/StopPoint/Search/".concat(t));case 2:return n=e.sent,a=n.matches[0].id,e.next=6,m.getJSON("https://api.tfl.gov.uk/StopPoint/".concat(a,"/Arrivals"));case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),A=function(e){var t=[],n=!0,a=!1,o=void 0;try{for(var r,s=e[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var i=r.value,c=i.destinationName,l=i.lineName,u=i.expectedArrival,d=N(u),m=void 0;m=0===(d=d>-1?d:0)?"Due":"".concat(d," min").concat(1===d?"":"s"),t.push({destination:c,routeNumber:l,timeUntilArrival:d,timeUntilArrivalString:m})}}catch(p){a=!0,o=p}finally{try{n||null==s.return||s.return()}finally{if(a)throw o}}return t.sort(function(e,t){return e.timeUntilArrival-t.timeUntilArrival})},B=(n(93),function(e){var t=e.className,n=void 0===t?"":t,a=e.arrivals,r=Object(h.a)(e,["className","arrivals"]);return o.a.createElement(p.Table,Object.assign({className:n},r),o.a.createElement("thead",null,o.a.createElement("tr",null,o.a.createElement("th",{"data-field":"route"},"Route"),o.a.createElement("th",{"data-field":"destination"},"Destination"),o.a.createElement("th",{"data-field":"time"},"Time"))),o.a.createElement("tbody",null,a.map(function(e,t){return o.a.createElement("tr",{key:t},o.a.createElement("td",null,e.routeNumber),o.a.createElement("td",null,e.destination),o.a.createElement("td",null,e.timeUntilArrivalString))})))}),W=function(e){function t(e){var n;Object(i.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).handleChange=function(e){n.setState(Object(C.a)({},e.target.id,e.target.value))},n.handleSubmit=Object(k.a)(S.a.mark(function e(){var t,a;return S.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.setState({arrivals:[],isLoading:!0}),e.next=3,x(n.state.stopCode);case 3:t=e.sent,a=A(t),n.setState({arrivals:a,isLoading:!1});case 6:case"end":return e.stop()}},e)})),n.validateStopCode=function(){return j.test(n.state.stopCode)},n.state={stopCode:"",isLoading:!1,userHasSubmitted:!1,arrivals:[]};var a=new URL(document.location.href).searchParams.get("stopCode");return null!==a&&(n.state.stopCode=a,n.handleSubmit().then()),n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return o.a.createElement("div",{className:"Home"},o.a.createElement(p.TextInput,{label:"Bus Stop Code",className:"no-helper",id:"stopCode",onChange:this.handleChange,value:this.state.stopCode,type:"number"}),o.a.createElement(p.Button,{waves:"light",className:"red darken-3",onClick:this.handleSubmit,disabled:!this.validateStopCode()},"Submit ",o.a.createElement(p.Icon,{right:!0},"send")),this.state.isLoading&&o.a.createElement(p.Row,{className:"center-align"},o.a.createElement(p.Preloader,{color:"red"})),this.state.arrivals.length>0&&o.a.createElement(B,{arrivals:this.state.arrivals}))}}]),t}(a.Component),D=n(35),L=(n(94),n(95),function(e){var t=e.stops,n=e.className,a=void 0===n?"":n,r=e.deleteStop,s=Object(h.a)(e,["stops","className","deleteStop"]);return o.a.createElement(p.Collection,Object.assign({className:a},s),t.map(function(e,t){return o.a.createElement(v.a,{to:"/?stopCode=".concat(e.stopCode),className:"collection-item black-text",key:t},e.stopName,o.a.createElement("i",{className:"material-icons red-text text-darken-3 secondary-content",onClick:function(t){t.preventDefault(),r(e.id)}},"close"))}))}),U=function(e){function t(e){var n;Object(i.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).saveStops=function(){var e=O();e.stops=n.state.stops,y(e)},n.handleChange=function(e){n.setState(Object(C.a)({},e.target.id,e.target.value))},n.handleSubmit=function(){var e={stopName:n.state.stopName,stopCode:n.state.stopCode,id:"".concat(Math.random().toString().replace("0.",""),"_").concat((new Date).getTime())};n.setState({stops:[].concat(Object(D.a)(n.state.stops),[e]),stopName:"",stopCode:""}),console.log(O())},n.deleteStop=function(e){console.log(e);var t=n.state.stops.filter(function(t){return t.id!==e});n.setState({stops:t})},n.validateForm=function(){return j.test(n.state.stopCode)&&n.state.stopName.length>0};var a=O(),o=a.hasOwnProperty("stops")?a.stops:[];return n.state={stopName:"",stopCode:"",stops:o},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;console.log(this.state),window.addEventListener("unload",function(){e.saveStops()})}},{key:"componentWillUnmount",value:function(){this.saveStops()}},{key:"render",value:function(){return o.a.createElement("div",{className:"UserStops"},o.a.createElement("h4",null,"Add a stop"),o.a.createElement(p.TextInput,{label:"Name",id:"stopName",onChange:this.handleChange,value:this.state.stopName,type:"text"}),o.a.createElement(p.TextInput,{label:"Stop Code",id:"stopCode",onChange:this.handleChange,value:this.state.stopCode,type:"number"}),o.a.createElement(p.Button,{waves:"light",className:"red darken-3",onClick:this.handleSubmit,disabled:!this.validateForm()},"Add ",o.a.createElement(p.Icon,{right:!0},"add")),o.a.createElement("div",{className:"divider"}),o.a.createElement("h4",null,"My Stops"),this.state.stops.length>0?o.a.createElement(L,{stops:this.state.stops,deleteStop:this.deleteStop}):o.a.createElement("h6",null,"You don't have any saved stops yet :("))}}]),t}(a.Component),M=function(){return o.a.createElement(b.a,null,o.a.createElement(E.a,{path:"/",exact:!0,component:W}),o.a.createElement(E.a,{path:"/user-stops",exact:!0,component:U}))},I=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={navLinks:[{name:"Home",href:"/"},{name:"My Stops",href:"/user-stops"}]},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{className:"App app-container"},o.a.createElement(g,{links:this.state.navLinks}),o.a.createElement(p.Container,null,o.a.createElement(M,null)))}}]),t}(a.Component),T=n(99),P=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function R(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}s.a.render(o.a.createElement(T.a,{basename:"/WMBB"},o.a.createElement(I,null)),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/WMBB",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("/WMBB","/service-worker.js");P?(function(e,t){fetch(e).then(function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):R(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")})):R(t,e)})}}()}},[[36,1,2]]]);
//# sourceMappingURL=main.ab1b6ea5.chunk.js.map